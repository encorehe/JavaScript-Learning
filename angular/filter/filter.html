<!DOCTYPE>
<html>
    <head>
        <title>filter</title>
        <script src="../angular.min.js"></script>
    </head>
    <body ng-app="exampleApp">
         <script>
             var data = {
                "statusCode" : 200,
                "message" : "",
                "totalCount" : 0,
                "result" : [ {
                    "cid" : "440305A0010001",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010004",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010005",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010006",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010007",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010008",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010009",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010010",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010011",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010012",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010013",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010014",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010015",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010016",
                    "pid" : null,
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1999999999999999999999999999999999",
                    "qty" : null
                }, {
                    "cid" : "440305A0010018",
                    "pid" : "440305A0010016",
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010019",
                    "pid" : "440305A0010024",
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010022",
                    "pid" : "440305A0010021",
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010026",
                    "pid" : "440305A0010019",
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010027",
                    "pid" : "440305A0010022",
                    "buildid" : "440305A001",
                    "meterid" : "440305A001M9999",
                    "circuitname" : "监测仪表名称1",
                    "qty" : null
                }, {
                    "cid" : "440305A0010029",
                    "pid" : "440305A0010001",
                    "buildid" : "440305A001",
                    "meterid" : "",
                    "circuitname" : "aaaaaaaaaaaaaaaaaaaaaaa",
                    "qty" : null
                }]
                };
                
                //angular filter（过滤数组)的原型 是 function(array, expression, comparator)
                // 第一个参数 array 是需要过滤的数组
                // 第二个参数 expression 是表达式，可接受的参数类型可以为 字符串,对象，或者函数。
                // 第三个参数 comparator 比较器，接受的参数是true，false，undefined，当为true表示完全匹配，达到了精确搜索的功能


                
                (function(angular) {
                    'use strict';
                    angular.module('exampleApp', []).
                    controller('EventController', ['$scope', '$filter', function($scope, $filter) {   
                        
                        var topData = $filter('filter')(data.result, {pid: null}, true);
                        console.log(angular.toJson(topData));
                        
                        var list = data.result;
                        
                        iterator(topData);
                        
                        function iterator(parentData){
                            for(var i=0; i<parentData.length; i++){
                                for(var j=0; j<list.length; ++j){
                                    if(parentData[i].cid==list[j].pid){
                                        if(!parentData[i].children){
                                            parentData[i].children = [];
                                        }
                                        
                                        console.log(list[j]);
                                        
                                        parentData[i].children.push(list[j]);
                                    }
                                }
                                if(parentData[i].children){
                                    iterator(parentData[i].children);
                                }
                            }
                        };
                        
                        console.log(angular.toJson(topData));
                        
                        
                        

                        
                    }]);
                   })(window.angular);

                
                

                
         </script>
         
         <div ng-controller="EventController"></div>
    </body>
</html>